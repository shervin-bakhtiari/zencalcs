<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="android-chrome-512x512.png">
    <title>Amortization Calculator - Loan Payment Schedule | ZenCalcs</title>
    <meta name="description" content="Free amortization calculator with extra payment options. See detailed monthly breakdown, total interest, and compare scenarios.">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMJ87N3YC3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-YMJ87N3YC3');
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        /* Typography */
        h1, h2, h3, h4, h5, h6 { font-family: 'Poppins', sans-serif; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #F8F9FA; min-height: 100vh; color: #2D3748; }

        /* Navigation */
        .navbar { background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 15px 30px; position: sticky; top: 0; z-index: 1000; }
        .nav-content { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo { height: 40px; width: auto; }
        .nav-right { display: flex; gap: 20px; align-items: center; }
        .search-box { display: flex; align-items: center; background: #FFFFFF; border: 1px solid #E5E7EB; border-radius: 8px; padding: 8px 16px; min-width: 250px; transition: all 0.3s ease; }
        .search-box:hover { border-color: #2C5F6F; }
        .search-box:focus-within { border-color: #2C5F6F; box-shadow: 0 0 0 3px rgba(44, 95, 111, 0.1); }
        .search-box svg { width: 20px; height: 20px; color: #6B7280; margin-right: 10px; }
        .search-box input { border: none; outline: none; background: transparent; flex: 1; color: #2D3748; font-size: 0.95em; }
        .search-box input::placeholder { color: #D1D5DB; }
        .hamburger { display: flex; flex-direction: column; gap: 5px; cursor: pointer; padding: 5px; }
        .hamburger span { width: 28px; height: 3px; background: #2C5F6F; border-radius: 3px; transition: all 0.3s ease; }
        .hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(8px, 8px); }
        .hamburger.active span:nth-child(2) { opacity: 0; }
        .hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(7px, -7px); }
        .mobile-menu { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: rgba(0,0,0,0.5); z-index: 999; }
        .mobile-menu.active { display: block; }
        .mobile-menu-content { position: fixed; top: 0; right: -350px; width: 320px; height: 100vh; background: white; box-shadow: -2px 0 10px rgba(0,0,0,0.1); transition: right 0.3s ease; padding: 80px 20px 20px 20px; overflow-y: auto; }
        .mobile-menu.active .mobile-menu-content { right: 0; }
        .search-container { padding: 10px 15px 20px; }
        .search-input { width: 100%; padding: 12px 15px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1em; }
        .search-input:focus { outline: none; border-color: #2C5F6F; box-shadow: 0 0 0 3px rgba(44, 95, 111, 0.1); }
        .category-header { font-size: 0.9em; font-weight: 700; color: #6B7280; padding: 15px 20px 10px; text-transform: uppercase; letter-spacing: 1px; }
        .category-divider { height: 1px; background: #E5E7EB; margin: 10px 0; }
        .mobile-menu-item { padding: 14px 20px; margin-bottom: 5px; background: #F8F9FA; border-radius: 8px; font-size: 0.95em; font-weight: 500; color: #2C5F6F; text-decoration: none; display: block; transition: all 0.3s ease; border-left: 4px solid transparent; }
        .mobile-menu-item:hover { background: #E0F2F1; border-left-color: #2C5F6F; transform: translateX(-5px); }
        .mobile-menu-item.placeholder { opacity: 0.5; cursor: not-allowed; }
        .mobile-menu-item.placeholder:hover { transform: none; }

        .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        .calculator-section { background: white; border-radius: 15px; padding: 40px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); margin-bottom: 30px; }
        .calculator-section h1 { color: #2D3748; margin-bottom: 10px; font-size: 2.2em; text-align: center; }
        .calc-subtitle { text-align: center; color: #6B7280; margin-bottom: 30px; font-size: 1.1em; }
        .description { background: #E0F2F1; padding: 25px; border-radius: 12px; margin-bottom: 30px; border-left: 5px solid #2C5F6F; }
        .description p { color: #4B5563; line-height: 1.8; font-size: 1.05em; }

        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; font-weight: 600; margin-bottom: 8px; color: #4B5563; font-size: 1em; }
        .input-group input, .input-group select { width: 100%; padding: 14px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1em; transition: all 0.3s ease; }
        .input-group input:focus, .input-group select:focus { outline: none; border-color: #2C5F6F; box-shadow: 0 0 0 3px rgba(44, 95, 111, 0.1); }
        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .input-row-3 { display: grid; grid-template-columns: 2fr 1fr; gap: 15px; }

        .extra-payments-section { margin-top: 30px; border: 2px solid #E5E7EB; border-radius: 12px; overflow: hidden; }
        .extra-payments-header { background: #F8F9FA; padding: 18px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s ease; }
        .extra-payments-header:hover { background: #E0F2F1; }
        .extra-payments-header h3 { color: #2C5F6F; font-size: 1.2em; margin: 0; }
        .toggle-icon { font-size: 1.5em; color: #2C5F6F; transition: transform 0.3s ease; }
        .toggle-icon.active { transform: rotate(180deg); }
        .extra-payments-content { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
        .extra-payments-content.active { max-height: 800px; }
        .extra-payments-body { padding: 25px; background: #FAFBFC; }

        .calculate-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, #E89B6F 0%, #F4A460 100%); color: white; border: none; border-radius: 10px; font-size: 1.2em; font-weight: 700; cursor: pointer; transition: all 0.3s ease; margin-top: 25px; box-shadow: 0 4px 15px rgba(232, 155, 111, 0.4); }
        .calculate-btn:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(232, 155, 111, 0.5); }

        .result-section { margin-top: 40px; display: none; }
        .key-insight { background: linear-gradient(135deg, #E89B6F 0%, #F4A460 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 4px 20px rgba(44, 95, 111, 0.3); }
        .key-insight h3 { font-size: 1.5em; margin-bottom: 15px; }
        .key-insight p, .key-insight ul { font-size: 1.1em; line-height: 1.8; opacity: 0.95; }
        .key-insight ul { margin-top: 15px; padding-left: 25px; }
        .key-insight li { margin-bottom: 10px; }

        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .metric-card { background: #F8F9FA; padding: 25px; border-radius: 12px; border-left: 5px solid #2C5F6F; transition: all 0.3s ease; }
        .metric-card:hover { transform: translateY(-3px); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .metric-label { font-size: 0.95em; color: #6B7280; margin-bottom: 10px; font-weight: 600; }
        .metric-value { font-size: 2em; font-weight: 700; color: #2C5F6F; word-break: break-word; }

        .chart-container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); margin-bottom: 30px; position: relative; height: 450px; }
        .chart-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }

        .view-toggle { display: flex; gap: 10px; margin-bottom: 20px; justify-content: center; }
        .view-btn { padding: 12px 24px; background: #F8F9FA; border: 2px solid #E5E7EB; border-radius: 8px; font-weight: 600; color: #4B5563; cursor: pointer; transition: all 0.3s ease; }
        .view-btn.active { background: #2C5F6F; color: white; border-color: #2C5F6F; }
        .view-btn:hover { background: #E0F2F1; }

        .show-all-toggle { text-align: center; margin-top: 20px; }
        .show-all-btn { padding: 12px 30px; background: #F8F9FA; border: 2px solid #2C5F6F; border-radius: 8px; font-weight: 600; color: #2C5F6F; cursor: pointer; transition: all 0.3s ease; }
        .show-all-btn:hover { background: #2C5F6F; color: white; }

        .table-wrapper { width: 100%; overflow-x: auto; margin-top: 30px; -webkit-overflow-scrolling: touch; }
        .table-wrapper::-webkit-scrollbar { height: 8px; }
        .table-wrapper::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .table-wrapper::-webkit-scrollbar-thumb { background: #2C5F6F; border-radius: 10px; }
        .table-wrapper::-webkit-scrollbar-thumb:hover { background: #2C5F6F; }
        .data-table { width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 12px rgba(0,0,0,0.08); }
        .data-table thead { background: #2C5F6F; color: white; }
        .data-table th, .data-table td { padding: 16px; text-align: left; border-bottom: 1px solid #E5E7EB; white-space: nowrap; }
        .data-table th { font-weight: 700; }
        .data-table tbody tr { transition: background 0.2s ease; }
        .data-table tbody tr:hover { background: #F8F9FA; }
        .data-table tbody tr:last-child td { border-bottom: none; }
        .data-table tbody tr.hidden-row { display: none; }

        @media (max-width: 768px) {
            .navbar { padding: 10px 15px; }
            .logo { height: 32px; }
            .nav-right { gap: 10px; }
            .search-box { min-width: 50px; padding: 6px 8px; }
            .search-box svg { width: 16px; height: 16px; margin-right: 4px; }
            .search-box input { font-size: 0.8em; }
            .calculator-section { padding: 25px; }
            .chart-container { height: 300px; padding: 20px; }
            .chart-row { grid-template-columns: 1fr; }
            .input-row, .input-row-3 { grid-template-columns: 1fr; }
            .mobile-menu-content { width: 280px; right: -280px; }
            .hamburger { margin-left: 5px; padding: 3px; }
            .hamburger span { width: 24px; }
        }
        @media (max-width: 400px) {
            .navbar { padding: 8px 12px; }
            .logo { height: 28px; }
            .nav-right { gap: 8px; }
            .search-box { min-width: 40px; padding: 5px 6px; }
            .hamburger span { width: 22px; }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">
                <img src="50F4465B-4D0A-459B-AAD8-B367AAEEF636.jpg" alt="ZenCalcs Logo" class="logo">
            </a>

            <div class="nav-right">
                <div class="search-box" onclick="openSearchInMenu()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <input type="text" placeholder="Search Calculator" readonly onclick="openSearchInMenu()">
                </div>
                <div class="hamburger" onclick="toggleMobileMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Slide-out Menu -->
    <div class="mobile-menu" id="mobileMenu" onclick="closeMobileMenu()">
        <div class="mobile-menu-content" onclick="event.stopPropagation()">
            <!-- Search Bar -->
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="Search calculators..." onkeyup="filterCalculators()">
            </div>

            <!-- Financial Calculators -->
            <div class="category-header">Financial</div>
            <a href="mortgage-calculator.html" class="mobile-menu-item">Mortgage Calculator</a>
            <a href="loan-calculator.html" class="mobile-menu-item">Loan Calculator</a>
            <a href="auto-loan-calculator.html" class="mobile-menu-item">Auto Loan Calculator</a>
            <a href="compound-interest.html" class="mobile-menu-item">Savings Calculator</a>
            <a href="payment-calculator.html" class="mobile-menu-item">Payment Calculator</a>
            <a href="retirement-calculator.html" class="mobile-menu-item">Retirement Calculator</a>
            <a href="amortization-calculator.html" class="mobile-menu-item">Amortization Calculator</a>
            <a href="investment-calculator.html" class="mobile-menu-item">Investment Calculator</a>
            <a href="inflation-calculator.html" class="mobile-menu-item">Inflation Calculator</a>
            <a href="roi-calculator.html" class="mobile-menu-item">ROI Calculator</a>
            <a href="savings-calculator.html" class="mobile-menu-item">Income Tax Calculator</a>

            <div class="category-divider"></div>

            <!-- Fitness & Health -->
            <div class="category-header">Fitness & Health</div>
            <a href="bmi-calculator.html" class="mobile-menu-item">BMI Calculator</a>
            <a href="calorie-calculator.html" class="mobile-menu-item">Calorie Calculator</a>
            <a href="body-fat-calculator.html" class="mobile-menu-item">Body Fat Calculator</a>
            <a href="bmr-calculator.html" class="mobile-menu-item">BMR Calculator</a>
            <a href="ideal-weight-calculator.html" class="mobile-menu-item">Ideal Weight Calculator</a>
            <a href="pace-calculator.html" class="mobile-menu-item">Pace Calculator</a>
            <a href="pregnancy-calculator.html" class="mobile-menu-item">Pregnancy Calculator</a>
            <a href="due-date-calculator.html" class="mobile-menu-item">Due Date Calculator</a>
            <a href="macro-calculator.html" class="mobile-menu-item">Macro Calculator</a>
            <a href="body-type-calculator.html" class="mobile-menu-item">Body Type Calculator</a>

            <div class="category-divider"></div>

            <!-- Math Calculators -->
            <div class="category-header">Math</div>
            <a href="scientific-calculator.html" class="mobile-menu-item">Scientific Calculator</a>
            <a href="fraction-calculator.html" class="mobile-menu-item">Fraction Calculator</a>
            <a href="percentage-calculator.html" class="mobile-menu-item">Percentage Calculator</a>
            <a href="random-number-generator.html" class="mobile-menu-item">Random Number Generator</a>
            <a href="triangle-calculator.html" class="mobile-menu-item">Triangle Calculator</a>
            <a href="standard-deviation-calculator.html" class="mobile-menu-item">Standard Deviation Calculator</a>
            <a href="square-root-calculator.html" class="mobile-menu-item">Square Root Calculator</a>
            <a href="exponent-calculator.html" class="mobile-menu-item">Exponent Calculator</a>
            <a href="log-calculator.html" class="mobile-menu-item">Log Calculator</a>
            <a href="algebra-calculator.html" class="mobile-menu-item">Algebra Calculator</a>

            <div class="category-divider"></div>

            <!-- Other Calculators -->
            <div class="category-header">Other</div>
            <a href="#" class="mobile-menu-item placeholder">Age Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">Date Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">Time Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">Hours Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">GPA Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">Grade Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">Concrete Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">Password Generator</a>
            <a href="#" class="mobile-menu-item placeholder">Conversion Calculator</a>
            <a href="salary-calculator.html" class="mobile-menu-item">Salary Calculator</a>
        </div>
    </div>

    <div class="container">
        <div class="calculator-section">
            <h1>Amortization Calculator</h1>
            <p class="calc-subtitle">Detailed loan payment schedule with extra payment options</p>

            <div class="description">
                <p>Calculate your loan amortization schedule with detailed monthly and yearly breakdowns. See how extra payments can save you thousands in interest and shorten your loan term. Our calculator provides comprehensive payment schedules, interactive charts, and shows the exact impact of additional payments.</p>
            </div>

            <div class="input-group">
                <label>Loan Amount ($)</label>
                <input type="number" id="loanAmount" value="200000" min="0" step="1000">
            </div>

            <div class="input-row-3">
                <div class="input-group">
                    <label>Loan Term (Years)</label>
                    <input type="number" id="loanYears" value="15" min="0" max="40">
                </div>
                <div class="input-group">
                    <label>Additional Months</label>
                    <input type="number" id="loanMonths" value="0" min="0" max="11">
                </div>
            </div>

            <div class="input-row">
                <div class="input-group">
                    <label>Interest Rate (%)</label>
                    <input type="number" id="interestRate" value="5" step="0.1" min="0" max="30">
                </div>
                <div class="input-group">
                    <label>Loan Start Month</label>
                    <select id="startMonth">
                        <option value="0">January</option>
                        <option value="1">February</option>
                        <option value="2">March</option>
                        <option value="3">April</option>
                        <option value="4">May</option>
                        <option value="5">June</option>
                        <option value="6">July</option>
                        <option value="7">August</option>
                        <option value="8">September</option>
                        <option value="9">October</option>
                        <option value="10">November</option>
                        <option value="11">December</option>
                    </select>
                </div>
            </div>

            <!-- Extra Payments Section -->
            <div class="extra-payments-section">
                <div class="extra-payments-header" onclick="toggleExtraPayments()">
                    <h3>Add Extra Payments</h3>
                    <span class="toggle-icon" id="toggleIcon">▼</span>
                </div>
                <div class="extra-payments-content" id="extraPaymentsContent">
                    <div class="extra-payments-body">
                        <div class="input-row">
                            <div class="input-group">
                                <label>Extra Monthly Payment ($)</label>
                                <input type="number" id="extraMonthly" value="0" min="0" step="50">
                            </div>
                            <div class="input-group">
                                <label>Start at Month #</label>
                                <input type="number" id="extraMonthlyStart" value="1" min="1">
                            </div>
                        </div>

                        <div class="input-row">
                            <div class="input-group">
                                <label>Extra Yearly Payment ($)</label>
                                <input type="number" id="extraYearly" value="0" min="0" step="100">
                            </div>
                            <div class="input-group">
                                <label>Start at Month #</label>
                                <input type="number" id="extraYearlyStart" value="12" min="1">
                            </div>
                        </div>

                        <div class="input-row">
                            <div class="input-group">
                                <label>One-Time Extra Payment ($)</label>
                                <input type="number" id="extraOneTime" value="0" min="0" step="100">
                            </div>
                            <div class="input-group">
                                <label>At Month #</label>
                                <input type="number" id="extraOneTimeMonth" value="1" min="1">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <button class="calculate-btn" onclick="calculateAmortization()">Calculate Amortization</button>
            <div class="result-section" id="result"></div>
        </div>
    </div>

    <script>
        let pieChartInstance = null;
        let lineChartInstance = null;
        let showAllMonths = false;
        let monthlyData = [];
        let currentView = 'monthly';

        // Set default month to current month
        const currentMonth = new Date().getMonth();
        document.getElementById('startMonth').value = currentMonth;

        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
        }

        function formatDate(year, month) {
            const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            return `${monthNames[month]} ${year}`;
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const hamburger = document.querySelector('.hamburger');
            menu.classList.toggle('active');
            hamburger.classList.toggle('active');
        }

        function closeMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const hamburger = document.querySelector('.hamburger');
            menu.classList.remove('active');
            hamburger.classList.remove('active');
        }

        function openSearchInMenu() {
            const menu = document.getElementById('mobileMenu');
            const hamburger = document.querySelector('.hamburger');
            menu.classList.add('active');
            hamburger.classList.add('active');
            setTimeout(() => {
                document.getElementById('searchInput').focus();
            }, 300);
        }

        function filterCalculators() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const items = document.querySelectorAll('.mobile-menu-item');
            const headers = document.querySelectorAll('.category-header');
            const dividers = document.querySelectorAll('.category-divider');

            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });

            // Hide/show category headers based on visible items
            if (searchTerm) {
                headers.forEach(header => header.style.display = 'none');
                dividers.forEach(divider => divider.style.display = 'none');
            } else {
                headers.forEach(header => header.style.display = 'block');
                dividers.forEach(divider => divider.style.display = 'block');
            }
        }

        function toggleExtraPayments() {
            const content = document.getElementById('extraPaymentsContent');
            const icon = document.getElementById('toggleIcon');
            content.classList.toggle('active');
            icon.classList.toggle('active');
        }

        function toggleView(view) {
            currentView = view;
            const monthlyBtn = document.getElementById('monthlyViewBtn');
            const annualBtn = document.getElementById('annualViewBtn');
            const monthlyTable = document.getElementById('monthlyTable');
            const annualTable = document.getElementById('annualTable');

            if (view === 'monthly') {
                monthlyBtn.classList.add('active');
                annualBtn.classList.remove('active');
                monthlyTable.style.display = 'block';
                annualTable.style.display = 'none';
            } else {
                monthlyBtn.classList.remove('active');
                annualBtn.classList.add('active');
                monthlyTable.style.display = 'none';
                annualTable.style.display = 'block';
            }
        }

        function toggleShowAll() {
            showAllMonths = !showAllMonths;
            const rows = document.querySelectorAll('.data-table tbody tr.hidden-row');
            const btn = document.getElementById('showAllBtn');

            rows.forEach(row => {
                if (showAllMonths) {
                    row.classList.remove('hidden-row');
                } else {
                    row.classList.add('hidden-row');
                }
            });

            btn.textContent = showAllMonths ? 'Show Less' : 'Show All';
        }

        function calculateAmortization() {
            const loanAmount = parseFloat(document.getElementById('loanAmount').value);
            const loanYears = parseInt(document.getElementById('loanYears').value);
            const loanMonths = parseInt(document.getElementById('loanMonths').value);
            const annualRate = parseFloat(document.getElementById('interestRate').value);
            const startMonth = parseInt(document.getElementById('startMonth').value);

            const extraMonthly = parseFloat(document.getElementById('extraMonthly').value) || 0;
            const extraMonthlyStart = parseInt(document.getElementById('extraMonthlyStart').value) || 1;
            const extraYearly = parseFloat(document.getElementById('extraYearly').value) || 0;
            const extraYearlyStart = parseInt(document.getElementById('extraYearlyStart').value) || 12;
            const extraOneTime = parseFloat(document.getElementById('extraOneTime').value) || 0;
            const extraOneTimeMonth = parseInt(document.getElementById('extraOneTimeMonth').value) || 1;

            const monthlyRate = (annualRate / 100) / 12;
            const totalMonths = (loanYears * 12) + loanMonths;

            // Calculate base monthly payment
            const basePayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, totalMonths)) /
                                (Math.pow(1 + monthlyRate, totalMonths) - 1);

            // Calculate amortization with extra payments
            let balance = loanAmount;
            monthlyData = [];
            let totalInterestPaid = 0;
            let totalPrincipalPaid = 0;
            let totalExtraPayments = 0;
            let actualMonths = 0;

            const currentYear = new Date().getFullYear();
            let year = currentYear;
            let month = startMonth;

            for (let i = 1; i <= totalMonths && balance > 0.01; i++) {
                const interestPayment = balance * monthlyRate;
                let principalPayment = basePayment - interestPayment;
                let extraPayment = 0;

                // Apply extra monthly payment
                if (i >= extraMonthlyStart) {
                    extraPayment += extraMonthly;
                }

                // Apply extra yearly payment
                if (i >= extraYearlyStart && (i - extraYearlyStart) % 12 === 0) {
                    extraPayment += extraYearly;
                }

                // Apply one-time extra payment
                if (i === extraOneTimeMonth) {
                    extraPayment += extraOneTime;
                }

                // Adjust if payment would exceed balance
                if (principalPayment + extraPayment > balance) {
                    extraPayment = Math.max(0, balance - principalPayment);
                    principalPayment = balance - extraPayment;
                }

                balance -= (principalPayment + extraPayment);
                totalInterestPaid += interestPayment;
                totalPrincipalPaid += principalPayment;
                totalExtraPayments += extraPayment;

                monthlyData.push({
                    month: i,
                    date: formatDate(year, month),
                    interest: interestPayment,
                    principal: principalPayment,
                    extra: extraPayment,
                    payment: basePayment + extraPayment,
                    balance: Math.max(0, balance)
                });

                actualMonths = i;

                // Increment month and year
                month++;
                if (month > 11) {
                    month = 0;
                    year++;
                }

                if (balance <= 0.01) break;
            }

            // Calculate annual data
            let yearlyData = [];
            let yearInterest = 0;
            let yearPrincipal = 0;
            let yearExtra = 0;
            let currentYearNum = 1;

            monthlyData.forEach((data, index) => {
                yearInterest += data.interest;
                yearPrincipal += data.principal;
                yearExtra += data.extra;

                if ((index + 1) % 12 === 0 || index === monthlyData.length - 1) {
                    yearlyData.push({
                        year: currentYearNum,
                        interest: yearInterest,
                        principal: yearPrincipal,
                        extra: yearExtra,
                        balance: data.balance
                    });
                    yearInterest = 0;
                    yearPrincipal = 0;
                    yearExtra = 0;
                    currentYearNum++;
                }
            });

            const totalPaid = totalInterestPaid + totalPrincipalPaid + totalExtraPayments;
            const principalPercent = ((totalPrincipalPaid + totalExtraPayments) / totalPaid * 100).toFixed(1);
            const interestPercent = (totalInterestPaid / totalPaid * 100).toFixed(1);

            // Calculate original payoff info
            let originalMonths = totalMonths;
            let originalTotalInterest = 0;
            let origBalance = loanAmount;
            for (let i = 1; i <= totalMonths; i++) {
                const interest = origBalance * monthlyRate;
                const principal = basePayment - interest;
                originalTotalInterest += interest;
                origBalance -= principal;
            }

            const hasExtraPayments = totalExtraPayments > 0;
            const interestSaved = originalTotalInterest - totalInterestPaid;
            const monthsSaved = originalMonths - actualMonths;

            // Calculate payoff dates
            const originalPayoffDate = new Date(currentYear, startMonth);
            originalPayoffDate.setMonth(originalPayoffDate.getMonth() + originalMonths);

            const newPayoffDate = new Date(currentYear, startMonth);
            newPayoffDate.setMonth(newPayoffDate.getMonth() + actualMonths);

            const resultDiv = document.getElementById('result');
            let insightHTML = `
                <div class="key-insight">
                    <h3>Your Amortization Summary</h3>
                    <p>Your monthly payment is <strong>${formatCurrency(basePayment)}</strong>. Over ${actualMonths} months (${Math.floor(actualMonths/12)} years, ${actualMonths % 12} months), you'll pay <strong>${formatCurrency(totalInterestPaid)}</strong> in interest.</p>
                    <ul>
                        <li><strong>Principal to Interest Ratio:</strong> ${principalPercent}% principal / ${interestPercent}% interest</li>`;

            if (hasExtraPayments) {
                insightHTML += `
                        <li><strong>Extra Payments:</strong> ${formatCurrency(totalExtraPayments)} total</li>
                        <li><strong>Interest Saved:</strong> ${formatCurrency(interestSaved)} by making extra payments</li>
                        <li><strong>Time Saved:</strong> ${monthsSaved} months (${Math.floor(monthsSaved/12)} years, ${monthsSaved % 12} months)</li>`;
            }

            insightHTML += `
                    </ul>
                </div>
            `;

            let metricsHTML = `
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Monthly Payment</div>
                        <div class="metric-value">${formatCurrency(basePayment)}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Total of All Payments</div>
                        <div class="metric-value">${formatCurrency(totalPaid)}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Total Interest Paid</div>
                        <div class="metric-value">${formatCurrency(totalInterestPaid)}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Principal to Interest Ratio</div>
                        <div class="metric-value">${principalPercent}% / ${interestPercent}%</div>
                    </div>`;

            if (hasExtraPayments) {
                metricsHTML += `
                    <div class="metric-card">
                        <div class="metric-label">Original Payoff Date</div>
                        <div class="metric-value" style="font-size: 1.5em;">${originalPayoffDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">New Payoff Date</div>
                        <div class="metric-value" style="font-size: 1.5em;">${newPayoffDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Interest Saved</div>
                        <div class="metric-value">${formatCurrency(interestSaved)}</div>
                    </div>`;
            }

            metricsHTML += `</div>`;

            // Generate monthly table
            let monthlyTableHTML = `
                <h3 style="margin: 25px 0 15px 0; color: #2D3748; font-size: 1.5em;">Amortization Schedule</h3>
                <div class="view-toggle">
                    <button class="view-btn active" id="monthlyViewBtn" onclick="toggleView('monthly')">Monthly View</button>
                    <button class="view-btn" id="annualViewBtn" onclick="toggleView('annual')">Annual View</button>
                </div>

                <div id="monthlyTable" class="table-wrapper">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Date</th>
                            <th>Interest</th>
                            <th>Principal</th>`;

            if (hasExtraPayments) {
                monthlyTableHTML += `<th>Extra Payment</th>`;
            }

            monthlyTableHTML += `
                            <th>Balance</th>
                        </tr>
                    </thead>
                    <tbody>`;

            monthlyData.forEach((row, index) => {
                const rowClass = index >= 12 ? 'hidden-row' : '';
                monthlyTableHTML += `
                    <tr class="${rowClass}">
                        <td><strong>${row.month}</strong></td>
                        <td>${row.date}</td>
                        <td>${formatCurrency(row.interest)}</td>
                        <td>${formatCurrency(row.principal)}</td>`;

                if (hasExtraPayments) {
                    monthlyTableHTML += `<td>${row.extra > 0 ? formatCurrency(row.extra) : '-'}</td>`;
                }

                monthlyTableHTML += `
                        <td>${formatCurrency(row.balance)}</td>
                    </tr>`;
            });

            monthlyTableHTML += `
                    </tbody>
                </table>
                </div>`;

            if (monthlyData.length > 12) {
                monthlyTableHTML += `
                <div class="show-all-toggle">
                    <button class="show-all-btn" id="showAllBtn" onclick="toggleShowAll()">Show All</button>
                </div>`;
            }

            // Generate annual table
            let annualTableHTML = `
                <div id="annualTable" class="table-wrapper" style="display: none;">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Year</th>
                            <th>Total Interest</th>
                            <th>Total Principal</th>`;

            if (hasExtraPayments) {
                annualTableHTML += `<th>Total Extra</th>`;
            }

            annualTableHTML += `
                            <th>Year-end Balance</th>
                        </tr>
                    </thead>
                    <tbody>`;

            yearlyData.forEach(row => {
                annualTableHTML += `
                    <tr>
                        <td><strong>Year ${row.year}</strong></td>
                        <td>${formatCurrency(row.interest)}</td>
                        <td>${formatCurrency(row.principal)}</td>`;

                if (hasExtraPayments) {
                    annualTableHTML += `<td>${row.extra > 0 ? formatCurrency(row.extra) : '-'}</td>`;
                }

                annualTableHTML += `
                        <td>${formatCurrency(row.balance)}</td>
                    </tr>`;
            });

            annualTableHTML += `
                    </tbody>
                </table>
                </div>`;

            resultDiv.innerHTML = `
                ${insightHTML}
                ${metricsHTML}

                <div class="chart-row">
                    <div class="chart-container">
                        <canvas id="pieChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="lineChart"></canvas>
                    </div>
                </div>

                ${monthlyTableHTML}
                ${annualTableHTML}
            `;

            resultDiv.style.display = 'block';
            showAllMonths = false;

            // Smooth scroll to results
            setTimeout(() => {
                resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);

            // Destroy old charts
            if (pieChartInstance) pieChartInstance.destroy();
            if (lineChartInstance) lineChartInstance.destroy();

            // Create pie chart
            setTimeout(() => {
                const pieCtx = document.getElementById('pieChart');
                pieChartInstance = new Chart(pieCtx.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: ['Principal', 'Interest'],
                        datasets: [{
                            data: [totalPrincipalPaid + totalExtraPayments, totalInterestPaid],
                            backgroundColor: ['#2C5F6F', '#E89B6F'],
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' },
                            title: {
                                display: true,
                                text: 'Principal vs Interest Breakdown',
                                font: { size: 16, weight: 'bold' }
                            },
                            tooltip: {
                                callbacks: {
                                    label: (context) => {
                                        const label = context.label || '';
                                        const value = formatCurrency(context.parsed);
                                        const percent = ((context.parsed / totalPaid) * 100).toFixed(1);
                                        return `${label}: ${value} (${percent}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            }, 100);

            // Create line chart
            setTimeout(() => {
                const lineCtx = document.getElementById('lineChart');
                const chartData = monthlyData.filter((_, i) => i % Math.max(1, Math.floor(monthlyData.length / 50)) === 0);

                lineChartInstance = new Chart(lineCtx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: chartData.map(d => d.date),
                        datasets: [
                            {
                                label: 'Balance',
                                data: chartData.map(d => d.balance),
                                borderColor: '#2C5F6F',
                                backgroundColor: 'rgba(44, 95, 111, 0.1)',
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: 'Interest',
                                data: chartData.map(d => d.interest),
                                borderColor: '#E89B6F',
                                backgroundColor: 'rgba(232, 155, 111, 0.1)',
                                fill: false,
                                tension: 0.4
                            },
                            {
                                label: 'Payment',
                                data: chartData.map(d => d.payment),
                                borderColor: '#5FA8D3',
                                backgroundColor: 'rgba(95, 168, 211, 0.1)',
                                fill: false,
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' },
                            title: {
                                display: true,
                                text: 'Balance, Interest & Payment Over Time',
                                font: { size: 16, weight: 'bold' }
                            },
                            tooltip: {
                                callbacks: {
                                    label: (context) => context.dataset.label + ': ' + formatCurrency(context.parsed.y)
                                }
                            }
                        },
                        scales: {
                            y: {
                                ticks: {
                                    callback: (value) => '$' + (value / 1000).toFixed(0) + 'K'
                                }
                            }
                        }
                    }
                });
            }, 100);
        }
    </script>
    <!-- AI Chat Assistant -->
    <link rel="stylesheet" href="css/ai-chat.css">
    <script src="js/ai-chat.js"></script>
</body>
</html>
