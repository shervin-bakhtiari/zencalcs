<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="android-chrome-512x512.png">
    <title>Due Date Calculator - Calculate Your Baby's Due Date | ZenCalcs</title>
    <meta name="description" content="Free due date calculator with 4 calculation methods. Calculate estimated delivery date, term windows, and important pregnancy milestones.">
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMJ87N3YC3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-YMJ87N3YC3');
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        /* Typography */
        h1, h2, h3, h4, h5, h6 { font-family: 'Poppins', sans-serif; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #F8F9FA; min-height: 100vh; color: #2D3748; }

        /* Navigation */
        .navbar { background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 15px 30px; position: sticky; top: 0; z-index: 1000; }
        .nav-content { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo { height: 40px; width: auto; }
        .nav-right { display: flex; gap: 20px; align-items: center; }
        .search-box { display: flex; align-items: center; background: #FFFFFF; border: 1px solid #E5E7EB; border-radius: 8px; padding: 8px 16px; min-width: 250px; transition: all 0.3s ease; }
        .search-box:hover { border-color: #2C5F6F; }
        .search-box:focus-within { border-color: #2C5F6F; box-shadow: 0 0 0 3px rgba(44, 95, 111, 0.1); }
        .search-box svg { width: 20px; height: 20px; color: #6B7280; margin-right: 10px; }
        .search-box input { border: none; outline: none; background: transparent; flex: 1; color: #2D3748; font-size: 0.95em; }
        .search-box input::placeholder { color: #D1D5DB; }
        .hamburger { display: flex; flex-direction: column; gap: 5px; cursor: pointer; padding: 5px; }
        .hamburger span { width: 28px; height: 3px; background: #2C5F6F; border-radius: 3px; transition: all 0.3s ease; }
        .hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(8px, 8px); }
        .hamburger.active span:nth-child(2) { opacity: 0; }
        .hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(7px, -7px); }
        .mobile-menu { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: rgba(0,0,0,0.5); z-index: 999; }
        .mobile-menu.active { display: block; }
        .mobile-menu-content { position: fixed; top: 0; right: -350px; width: 320px; height: 100vh; background: white; box-shadow: -2px 0 10px rgba(0,0,0,0.1); transition: right 0.3s ease; padding: 80px 20px 20px 20px; overflow-y: auto; }
        .mobile-menu.active .mobile-menu-content { right: 0; }
        .search-container { padding: 10px 15px 20px; }
        .search-input { width: 100%; padding: 12px 15px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1em; }
        .search-input:focus { outline: none; border-color: #2C5F6F; box-shadow: 0 0 0 3px rgba(44, 95, 111, 0.1); }
        .category-header { font-size: 0.9em; font-weight: 700; color: #6B7280; padding: 15px 20px 10px; text-transform: uppercase; letter-spacing: 1px; }
        .category-divider { height: 1px; background: #E5E7EB; margin: 10px 0; }
        .mobile-menu-item { padding: 14px 20px; margin-bottom: 5px; background: #F8F9FA; border-radius: 8px; font-size: 0.95em; font-weight: 500; color: #2C5F6F; text-decoration: none; display: block; transition: all 0.3s ease; border-left: 4px solid transparent; }
        .mobile-menu-item:hover { background: #E0F2F1; border-left-color: #2C5F6F; transform: translateX(-5px); }
        .mobile-menu-item.placeholder { opacity: 0.5; cursor: not-allowed; }
        .mobile-menu-item.placeholder:hover { transform: none; }

        .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        .calculator-section { background: white; border-radius: 15px; padding: 40px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); margin-bottom: 30px; }
        .calculator-section h1 { color: #2D3748; margin-bottom: 10px; font-size: 2.2em; text-align: center; }
        .calc-subtitle { text-align: center; color: #6B7280; margin-bottom: 30px; font-size: 1.1em; }
        .description { background: #E0F2F1; padding: 25px; border-radius: 12px; margin-bottom: 30px; border-left: 5px solid #2C5F6F; }
        .description p { color: #4B5563; line-height: 1.8; font-size: 1.05em; }

        /* Tabs */
        .tabs { display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap; }
        .tab { padding: 12px 20px; background: #F8F9FA; border: 2px solid #E5E7EB; border-radius: 8px; cursor: pointer; font-weight: 600; color: #6B7280; transition: all 0.3s ease; flex: 1; min-width: 150px; text-align: center; }
        .tab:hover { background: #E0F2F1; border-color: #2C5F6F; }
        .tab.active { background: linear-gradient(135deg, #2C5F6F 0%, #1F4A56 100%); color: white; border-color: #2C5F6F; }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; font-weight: 600; margin-bottom: 8px; color: #4B5563; font-size: 1em; }
        .input-group input, .input-group select { width: 100%; padding: 14px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1em; transition: all 0.3s ease; }
        .input-group input:focus, .input-group select:focus { outline: none; border-color: #2C5F6F; box-shadow: 0 0 0 3px rgba(44, 95, 111, 0.1); }
        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .calculate-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, #E89B6F 0%, #F4A460 100%); color: white; border: none; border-radius: 10px; font-size: 1.2em; font-weight: 700; cursor: pointer; transition: all 0.3s ease; margin-top: 25px; box-shadow: 0 4px 15px rgba(232, 155, 111, 0.4); }
        .calculate-btn:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(232, 155, 111, 0.5); }

        .result-section { margin-top: 40px; display: none; }
        .key-insight { background: linear-gradient(135deg, #2C5F6F 0%, #1F4A56 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 4px 20px rgba(44, 95, 111, 0.3); }
        .key-insight h3 { font-size: 1.5em; margin-bottom: 15px; }
        .key-insight p, .key-insight ul { font-size: 1.1em; line-height: 1.8; opacity: 0.95; }
        .key-insight ul { margin-top: 15px; padding-left: 25px; }
        .key-insight li { margin-bottom: 10px; }
        .due-date-display { font-size: 2.5em; font-weight: 800; text-align: center; margin: 20px 0; }

        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .metric-card { background: #F8F9FA; padding: 25px; border-radius: 12px; border-left: 5px solid #2C5F6F; transition: all 0.3s ease; }
        .metric-card:hover { transform: translateY(-3px); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .metric-label { font-size: 0.95em; color: #6B7280; margin-bottom: 10px; font-weight: 600; }
        .metric-value { font-size: 1.8em; font-weight: 700; color: #2C5F6F; word-break: break-word; }

        .chart-container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); margin-bottom: 30px; position: relative; height: 400px; }

        .data-table { width: 100%; border-collapse: collapse; margin-top: 30px; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 12px rgba(0,0,0,0.08); }
        .data-table th { background: linear-gradient(135deg, #2C5F6F 0%, #1F4A56 100%); color: white; padding: 15px; text-align: left; font-weight: 600; }
        .data-table td { padding: 15px; border-bottom: 1px solid #E5E7EB; }
        .data-table tr:hover { background: #F8F9FA; }
        .data-table tr:last-child td { border-bottom: none; }

        @media (max-width: 768px) {
            .navbar { padding: 10px 15px; }
            .logo { height: 32px; }
            .nav-right { gap: 10px; }
            .search-box { min-width: 50px; padding: 6px 8px; }
            .search-box svg { width: 16px; height: 16px; margin-right: 4px; }
            .search-box input { font-size: 0.8em; }
            .calculator-section { padding: 25px; }
            .chart-container { height: 300px; padding: 20px; }
            .input-row { grid-template-columns: 1fr; }
            .mobile-menu-content { width: 280px; right: -280px; }
            .hamburger { margin-left: 5px; padding: 3px; }
            .hamburger span { width: 24px; }
            .tabs { flex-direction: column; }
            .tab { min-width: 100%; }
            .due-date-display { font-size: 1.8em; }
            .data-table { font-size: 0.9em; }
            .data-table th, .data-table td { padding: 10px; }
        }
        @media (max-width: 400px) {
            .navbar { padding: 8px 12px; }
            .logo { height: 28px; }
            .nav-right { gap: 8px; }
            .search-box { min-width: 40px; padding: 5px 6px; }
            .hamburger span { width: 22px; }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">
                <img src="50F4465B-4D0A-459B-AAD8-B367AAEEF636.jpg" alt="ZenCalcs Logo" class="logo">
            </a>
            <div class="nav-right">
                <div class="search-box" onclick="openSearchInMenu()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <input type="text" placeholder="Search Calculator" readonly onclick="openSearchInMenu()">
                </div>
                <div class="hamburger" onclick="toggleMobileMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </nav>

    <div class="mobile-menu" id="mobileMenu" onclick="closeMobileMenu()">
        <div class="mobile-menu-content" onclick="event.stopPropagation()">
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="Search calculators..." onkeyup="filterCalculators()">
            </div>
            <div class="category-header">Financial</div>
            <a href="mortgage-calculator.html" class="mobile-menu-item">Mortgage Calculator</a>
            <a href="loan-calculator.html" class="mobile-menu-item">Loan Calculator</a>
            <a href="auto-loan-calculator.html" class="mobile-menu-item">Auto Loan Calculator</a>
            <a href="compound-interest.html" class="mobile-menu-item">Savings Calculator</a>
            <a href="payment-calculator.html" class="mobile-menu-item">Payment Calculator</a>
            <a href="retirement-calculator.html" class="mobile-menu-item">Retirement Calculator</a>
            <a href="amortization-calculator.html" class="mobile-menu-item">Amortization Calculator</a>
            <a href="investment-calculator.html" class="mobile-menu-item">Investment Calculator</a>
            <a href="inflation-calculator.html" class="mobile-menu-item">Inflation Calculator</a>
            <a href="roi-calculator.html" class="mobile-menu-item">ROI Calculator</a>
            <a href="savings-calculator.html" class="mobile-menu-item">Income Tax Calculator</a>
            <div class="category-divider"></div>
            <div class="category-header">Fitness & Health</div>
            <a href="bmi-calculator.html" class="mobile-menu-item">BMI Calculator</a>
            <a href="calorie-calculator.html" class="mobile-menu-item">Calorie Calculator</a>
            <a href="body-fat-calculator.html" class="mobile-menu-item">Body Fat Calculator</a>
            <a href="bmr-calculator.html" class="mobile-menu-item">BMR Calculator</a>
            <a href="ideal-weight-calculator.html" class="mobile-menu-item">Ideal Weight Calculator</a>
            <a href="pace-calculator.html" class="mobile-menu-item">Pace Calculator</a>
            <a href="pregnancy-calculator.html" class="mobile-menu-item">Pregnancy Calculator</a>
            <a href="due-date-calculator.html" class="mobile-menu-item">Due Date Calculator</a>
            <a href="macro-calculator.html" class="mobile-menu-item">Macro Calculator</a>
            <a href="body-type-calculator.html" class="mobile-menu-item">Body Type Calculator</a>
            <div class="category-divider"></div>
            <div class="category-header">Math</div>
            <a href="scientific-calculator.html" class="mobile-menu-item">Scientific Calculator</a>
            <a href="fraction-calculator.html" class="mobile-menu-item">Fraction Calculator</a>
            <a href="percentage-calculator.html" class="mobile-menu-item">Percentage Calculator</a>
            <a href="random-number-generator.html" class="mobile-menu-item">Random Number Generator</a>
            <a href="triangle-calculator.html" class="mobile-menu-item">Triangle Calculator</a>
            <a href="standard-deviation-calculator.html" class="mobile-menu-item">Standard Deviation Calculator</a>
            <a href="square-root-calculator.html" class="mobile-menu-item">Square Root Calculator</a>
            <a href="exponent-calculator.html" class="mobile-menu-item">Exponent Calculator</a>
            <a href="log-calculator.html" class="mobile-menu-item">Log Calculator</a>
            <a href="algebra-calculator.html" class="mobile-menu-item">Algebra Calculator</a>
            <div class="category-divider"></div>
            <div class="category-header">Other</div>
            <a href="#" class="mobile-menu-item placeholder">Age Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">Date Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">Time Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">Hours Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">GPA Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">Grade Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">Concrete Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">Password Generator</a>
            <a href="#" class="mobile-menu-item placeholder">Conversion Calculator</a>
            <a href="salary-calculator.html" class="mobile-menu-item">Salary Calculator</a>
        </div>
    </div>

    <div class="container">
        <div class="calculator-section">
            <h1>Due Date Calculator</h1>
            <p class="calc-subtitle">Calculate your estimated delivery date and pregnancy milestones</p>

            <div class="description">
                <p>Calculate your baby's due date using multiple methods including last menstrual period, conception date, ultrasound, or IVF transfer date. Get detailed information about your pregnancy timeline, important milestones, and term classifications.</p>
            </div>

            <div class="tabs">
                <div class="tab active" onclick="switchTab('lmp')">Last Menstrual Period</div>
                <div class="tab" onclick="switchTab('conception')">Conception Date</div>
                <div class="tab" onclick="switchTab('ultrasound')">Ultrasound</div>
                <div class="tab" onclick="switchTab('ivf')">IVF Transfer</div>
            </div>

            <!-- LMP Method -->
            <div id="lmp-content" class="tab-content active">
                <div class="input-group">
                    <label>First Day of Last Period</label>
                    <input type="date" id="lmp-date" max="2025-12-31">
                </div>
                <div class="input-group">
                    <label>Average Cycle Length (days)</label>
                    <select id="cycle-length">
                        <option value="22">22 days</option>
                        <option value="23">23 days</option>
                        <option value="24">24 days</option>
                        <option value="25">25 days</option>
                        <option value="26">26 days</option>
                        <option value="27">27 days</option>
                        <option value="28" selected>28 days</option>
                        <option value="29">29 days</option>
                        <option value="30">30 days</option>
                        <option value="31">31 days</option>
                        <option value="32">32 days</option>
                        <option value="33">33 days</option>
                        <option value="34">34 days</option>
                        <option value="35">35 days</option>
                        <option value="36">36 days</option>
                        <option value="37">37 days</option>
                        <option value="38">38 days</option>
                        <option value="39">39 days</option>
                        <option value="40">40 days</option>
                        <option value="41">41 days</option>
                        <option value="42">42 days</option>
                        <option value="43">43 days</option>
                        <option value="44">44 days</option>
                    </select>
                </div>
            </div>

            <!-- Conception Method -->
            <div id="conception-content" class="tab-content">
                <div class="input-group">
                    <label>Conception Date</label>
                    <input type="date" id="conception-date" max="2025-12-31">
                </div>
            </div>

            <!-- Ultrasound Method -->
            <div id="ultrasound-content" class="tab-content">
                <div class="input-group">
                    <label>Ultrasound Date</label>
                    <input type="date" id="ultrasound-date" max="2025-12-31">
                </div>
                <div class="input-row">
                    <div class="input-group">
                        <label>Pregnancy Length at Ultrasound - Weeks</label>
                        <input type="number" id="ultrasound-weeks" min="0" max="42" value="0">
                    </div>
                    <div class="input-group">
                        <label>Pregnancy Length at Ultrasound - Days</label>
                        <input type="number" id="ultrasound-days" min="0" max="6" value="0">
                    </div>
                </div>
            </div>

            <!-- IVF Method -->
            <div id="ivf-content" class="tab-content">
                <div class="input-group">
                    <label>Transfer Date</label>
                    <input type="date" id="ivf-date" max="2025-12-31">
                </div>
                <div class="input-group">
                    <label>Embryo Age</label>
                    <select id="embryo-age">
                        <option value="3">Day 3</option>
                        <option value="5" selected>Day 5</option>
                        <option value="6">Day 6</option>
                    </select>
                </div>
            </div>

            <button class="calculate-btn" onclick="calculateDueDate()">Calculate Due Date</button>
            <div class="result-section" id="result"></div>
        </div>
    </div>

    <script>
        let timelineChart = null;
        let pieChart = null;
        let activeTab = 'lmp';

        // Set default dates (today)
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('lmp-date').value = today;
        document.getElementById('conception-date').value = today;
        document.getElementById('ultrasound-date').value = today;
        document.getElementById('ivf-date').value = today;

        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const hamburger = document.querySelector('.hamburger');
            menu.classList.toggle('active');
            hamburger.classList.toggle('active');
        }

        function closeMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const hamburger = document.querySelector('.hamburger');
            menu.classList.remove('active');
            hamburger.classList.remove('active');
        }

        function openSearchInMenu() {
            const menu = document.getElementById('mobileMenu');
            const hamburger = document.querySelector('.hamburger');
            menu.classList.add('active');
            hamburger.classList.add('active');
            setTimeout(() => {
                document.getElementById('searchInput').focus();
            }, 300);
        }

        function filterCalculators() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const items = document.querySelectorAll('.mobile-menu-item');
            const headers = document.querySelectorAll('.category-header');
            const dividers = document.querySelectorAll('.category-divider');

            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });

            if (searchTerm) {
                headers.forEach(header => header.style.display = 'none');
                dividers.forEach(divider => divider.style.display = 'none');
            } else {
                headers.forEach(header => header.style.display = 'block');
                dividers.forEach(divider => divider.style.display = 'block');
            }
        }

        function switchTab(tabName) {
            activeTab = tabName;

            // Update tab styling
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update content visibility
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-content').classList.add('active');
        }

        function addDays(date, days) {
            const result = new Date(date);
            result.setDate(result.getDate() + days);
            return result;
        }

        function daysBetween(date1, date2) {
            const oneDay = 24 * 60 * 60 * 1000;
            return Math.round((date2 - date1) / oneDay);
        }

        function formatDate(date) {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        function formatDateShort(date) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        function getTermClassification(dueDate) {
            const today = new Date();
            const daysUntilDue = daysBetween(today, dueDate);

            if (daysUntilDue >= 21) {
                return { term: 'Pre-term', color: '#5FA8D3', description: 'Not yet at term' };
            } else if (daysUntilDue >= 7) {
                return { term: 'Early Term', color: '#E89B6F', description: '37-39 weeks' };
            } else if (daysUntilDue >= -7) {
                return { term: 'Full Term', color: '#6B9080', description: '39-41 weeks' };
            } else if (daysUntilDue >= -14) {
                return { term: 'Late Term', color: '#E89B6F', description: '41-42 weeks' };
            } else {
                return { term: 'Post Term', color: '#F4A460', description: '42+ weeks' };
            }
        }

        function calculateGestationalAge(conceptionDate) {
            const today = new Date();
            const daysFromConception = daysBetween(conceptionDate, today);
            const weeks = Math.floor((daysFromConception + 14) / 7);
            const days = (daysFromConception + 14) % 7;
            return { weeks, days, totalDays: daysFromConception };
        }

        function calculateDueDate() {
            let dueDate, conceptionDate, lmpDate;

            try {
                if (activeTab === 'lmp') {
                    lmpDate = new Date(document.getElementById('lmp-date').value);
                    const cycleLength = parseInt(document.getElementById('cycle-length').value);

                    if (isNaN(lmpDate.getTime())) {
                        alert('Please enter a valid last menstrual period date');
                        return;
                    }

                    // Due date = LMP + 280 days
                    dueDate = addDays(lmpDate, 280);
                    // Conception date = LMP + (cycle length - 14) or cycle length / 2
                    conceptionDate = addDays(lmpDate, cycleLength - 14);

                } else if (activeTab === 'conception') {
                    conceptionDate = new Date(document.getElementById('conception-date').value);

                    if (isNaN(conceptionDate.getTime())) {
                        alert('Please enter a valid conception date');
                        return;
                    }

                    // Due date = Conception + 266 days
                    dueDate = addDays(conceptionDate, 266);
                    // LMP = Conception - 14 days (estimate)
                    lmpDate = addDays(conceptionDate, -14);

                } else if (activeTab === 'ultrasound') {
                    const ultrasoundDate = new Date(document.getElementById('ultrasound-date').value);
                    const weeks = parseInt(document.getElementById('ultrasound-weeks').value);
                    const days = parseInt(document.getElementById('ultrasound-days').value);

                    if (isNaN(ultrasoundDate.getTime())) {
                        alert('Please enter a valid ultrasound date');
                        return;
                    }

                    const gestationalDaysAtUltrasound = (weeks * 7) + days;
                    const remainingDays = 280 - gestationalDaysAtUltrasound;

                    // Due date = Ultrasound date + remaining days
                    dueDate = addDays(ultrasoundDate, remainingDays);
                    // LMP = Ultrasound date - gestational days
                    lmpDate = addDays(ultrasoundDate, -gestationalDaysAtUltrasound);
                    // Conception = LMP + 14 days
                    conceptionDate = addDays(lmpDate, 14);

                } else if (activeTab === 'ivf') {
                    const transferDate = new Date(document.getElementById('ivf-date').value);
                    const embryoAge = parseInt(document.getElementById('embryo-age').value);

                    if (isNaN(transferDate.getTime())) {
                        alert('Please enter a valid transfer date');
                        return;
                    }

                    // Calculate based on embryo age
                    let daysToAdd;
                    if (embryoAge === 3) {
                        daysToAdd = 263; // Day 3 embryo
                        conceptionDate = addDays(transferDate, -3);
                    } else if (embryoAge === 5) {
                        daysToAdd = 261; // Day 5 embryo
                        conceptionDate = addDays(transferDate, -5);
                    } else {
                        daysToAdd = 260; // Day 6 embryo
                        conceptionDate = addDays(transferDate, -6);
                    }

                    dueDate = addDays(transferDate, daysToAdd);
                    lmpDate = addDays(conceptionDate, -14);
                }

                // Calculate all the metrics
                const today = new Date();
                const gestationalAge = calculateGestationalAge(conceptionDate);
                const daysUntilDue = daysBetween(today, dueDate);
                const termInfo = getTermClassification(dueDate);

                // Calculate term windows
                const earlyTermStart = addDays(dueDate, -21); // 37 weeks
                const fullTermStart = addDays(dueDate, -7); // 39 weeks
                const lateTermStart = addDays(dueDate, 7); // 41 weeks
                const postTermStart = addDays(dueDate, 14); // 42 weeks

                // Calculate important milestones
                const milestones = [
                    { date: lmpDate, week: 0, description: 'First day of last period' },
                    { date: conceptionDate, week: 2, description: 'Estimated conception' },
                    { date: addDays(lmpDate, 84), week: 12, description: 'End of first trimester' },
                    { date: addDays(lmpDate, 126), week: 18, description: 'Anatomy scan window starts' },
                    { date: addDays(lmpDate, 154), week: 22, description: 'Anatomy scan window ends' },
                    { date: addDays(lmpDate, 168), week: 24, description: 'Viability' },
                    { date: addDays(lmpDate, 196), week: 28, description: 'Start of third trimester' },
                    { date: earlyTermStart, week: 37, description: 'Early term starts' },
                    { date: dueDate, week: 40, description: 'Due date (Full term)' },
                    { date: lateTermStart, week: 41, description: 'Late term starts' },
                    { date: postTermStart, week: 42, description: 'Post term' }
                ];

                // Generate results HTML
                const resultHTML = `
                    <div class="key-insight">
                        <h3>Estimated Due Date</h3>
                        <div class="due-date-display">${formatDate(dueDate)}</div>
                        <p><strong>Term Classification:</strong> ${termInfo.term} (${termInfo.description})</p>
                        ${gestationalAge.weeks >= 0 ? `<p><strong>Current Gestational Age:</strong> ${gestationalAge.weeks} weeks and ${gestationalAge.days} days</p>` : ''}
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-label">Conception Date</div>
                            <div class="metric-value" style="font-size: 1.3em;">${formatDateShort(conceptionDate)}</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Days Until Due Date</div>
                            <div class="metric-value">${daysUntilDue > 0 ? daysUntilDue : 'Overdue by ' + Math.abs(daysUntilDue)}</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Early Term Window</div>
                            <div class="metric-value" style="font-size: 1.3em;">${formatDateShort(earlyTermStart)}</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Full Term Window</div>
                            <div class="metric-value" style="font-size: 1.3em;">${formatDateShort(fullTermStart)} - ${formatDateShort(lateTermStart)}</div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <canvas id="timelineChart"></canvas>
                    </div>

                    <div class="chart-container">
                        <canvas id="pieChart"></canvas>
                    </div>

                    <h3 style="margin-top: 30px; margin-bottom: 15px; color: #2D3748;">Important Pregnancy Milestones</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Week</th>
                                <th>Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${milestones.map(m => `
                                <tr>
                                    <td>${formatDateShort(m.date)}</td>
                                    <td>${m.week} weeks</td>
                                    <td>${m.description}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                const resultDiv = document.getElementById('result');
                resultDiv.innerHTML = resultHTML;
                resultDiv.style.display = 'block';

                // Smooth scroll to results
                setTimeout(() => {
                    resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);

                // Create timeline chart
                createTimelineChart(conceptionDate, dueDate, earlyTermStart, fullTermStart, lateTermStart, postTermStart);

                // Create pie chart
                createPieChart(conceptionDate, dueDate);

            } catch (error) {
                alert('Please check your inputs and try again');
                console.error(error);
            }
        }

        function createTimelineChart(conception, dueDate, earlyTerm, fullTerm, lateTerm, postTerm) {
            if (timelineChart) {
                timelineChart.destroy();
            }

            const today = new Date();
            const startDate = conception;
            const totalDays = daysBetween(startDate, postTerm);

            // Calculate positions on timeline
            const conceptionPos = 0;
            const todayPos = daysBetween(startDate, today);
            const earlyTermPos = daysBetween(startDate, earlyTerm);
            const fullTermPos = daysBetween(startDate, fullTerm);
            const duePos = daysBetween(startDate, dueDate);
            const lateTermPos = daysBetween(startDate, lateTerm);
            const postTermPos = daysBetween(startDate, postTerm);

            const ctx = document.getElementById('timelineChart').getContext('2d');
            timelineChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Conception', 'Today', 'Early Term', 'Full Term', 'Due Date', 'Late Term', 'Post Term'],
                    datasets: [{
                        label: 'Days from Conception',
                        data: [conceptionPos, todayPos, earlyTermPos, fullTermPos, duePos, lateTermPos, postTermPos],
                        backgroundColor: [
                            '#2C5F6F',
                            '#5FA8D3',
                            '#E89B6F',
                            '#6B9080',
                            '#2C5F6F',
                            '#E89B6F',
                            '#F4A460'
                        ],
                        borderWidth: 2,
                        borderColor: '#1F4A56'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Pregnancy Timeline',
                            font: { size: 18, weight: 'bold' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Days from Conception'
                            }
                        }
                    }
                }
            });
        }

        function createPieChart(conception, dueDate) {
            if (pieChart) {
                pieChart.destroy();
            }

            const today = new Date();
            const timeElapsed = Math.max(0, daysBetween(conception, today));
            const timeRemaining = Math.max(0, daysBetween(today, dueDate));

            const ctx = document.getElementById('pieChart').getContext('2d');
            pieChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Time Elapsed', 'Time Remaining'],
                    datasets: [{
                        data: [timeElapsed, timeRemaining],
                        backgroundColor: ['#2C5F6F', '#E89B6F'],
                        borderWidth: 3,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { size: 14 },
                                padding: 20
                            }
                        },
                        title: {
                            display: true,
                            text: 'Pregnancy Progress',
                            font: { size: 18, weight: 'bold' }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    return label + ': ' + value + ' days';
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
    <!-- AI Chat Assistant -->
    <link rel="stylesheet" href="css/ai-chat.css">
    <script src="js/ai-chat.js"></script>
</body>
</html>
