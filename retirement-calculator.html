<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="android-chrome-512x512.png">
    <title>Retirement Calculator - Plan Your Retirement Savings | ZenCalcs</title>
    <meta name="description" content="Free retirement calculator. Plan your retirement savings, calculate income needs, and see if you're on track to retire comfortably.">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMJ87N3YC3"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-YMJ87N3YC3');
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        /* Typography */
        h1, h2, h3, h4, h5, h6 { font-family: 'Poppins', sans-serif; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: #F8F9FA; min-height: 100vh; color: #2D3748; }

        /* Navigation */
        .navbar { background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 15px 30px; position: sticky; top: 0; z-index: 1000; }
        .nav-content { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo { height: 40px; width: auto; }
        .nav-right { display: flex; gap: 20px; align-items: center; }
        .search-box { display: flex; align-items: center; background: #FFFFFF; border: 1px solid #E5E7EB; border-radius: 8px; padding: 8px 16px; min-width: 250px; transition: all 0.3s ease; }
        .search-box:hover { border-color: #2C5F6F; }
        .search-box:focus-within { border-color: #2C5F6F; box-shadow: 0 0 0 3px rgba(44, 95, 111, 0.1); }
        .search-box svg { width: 20px; height: 20px; color: #6B7280; margin-right: 10px; }
        .search-box input { border: none; outline: none; background: transparent; flex: 1; color: #2D3748; font-size: 0.95em; }
        .search-box input::placeholder { color: #D1D5DB; }
        .hamburger { display: flex; flex-direction: column; gap: 5px; cursor: pointer; padding: 5px; }
        .hamburger span { width: 28px; height: 3px; background: #2C5F6F; border-radius: 3px; transition: all 0.3s ease; }
        .hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(8px, 8px); }
        .hamburger.active span:nth-child(2) { opacity: 0; }
        .hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(7px, -7px); }
        .mobile-menu { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100vh; background: rgba(0,0,0,0.5); z-index: 999; }
        .mobile-menu.active { display: block; }
        .mobile-menu-content { position: fixed; top: 0; right: -350px; width: 320px; height: 100vh; background: white; box-shadow: -2px 0 10px rgba(0,0,0,0.1); transition: right 0.3s ease; padding: 80px 20px 20px 20px; overflow-y: auto; }
        .mobile-menu.active .mobile-menu-content { right: 0; }
        .search-container { padding: 10px 15px 20px; }
        .search-input { width: 100%; padding: 12px 15px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1em; }
        .search-input:focus { outline: none; border-color: #2C5F6F; box-shadow: 0 0 0 3px rgba(44, 95, 111, 0.1); }
        .category-header { font-size: 0.9em; font-weight: 700; color: #6B7280; padding: 15px 20px 10px; text-transform: uppercase; letter-spacing: 1px; }
        .category-divider { height: 1px; background: #E5E7EB; margin: 10px 0; }
        .mobile-menu-item { padding: 14px 20px; margin-bottom: 5px; background: #F8F9FA; border-radius: 8px; font-size: 0.95em; font-weight: 500; color: #2C5F6F; text-decoration: none; display: block; transition: all 0.3s ease; border-left: 4px solid transparent; }
        .mobile-menu-item:hover { background: #E0F2F1; border-left-color: #2C5F6F; transform: translateX(-5px); }
        .mobile-menu-item.placeholder { opacity: 0.5; cursor: not-allowed; }
        .mobile-menu-item.placeholder:hover { transform: none; }

        .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
        .calculator-section { background: white; border-radius: 15px; padding: 40px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); margin-bottom: 30px; }
        .calculator-section h1 { color: #2D3748; margin-bottom: 10px; font-size: 2.2em; text-align: center; }
        .calc-subtitle { text-align: center; color: #6B7280; margin-bottom: 30px; font-size: 1.1em; }
        .description { background: #E0F2F1; padding: 25px; border-radius: 12px; margin-bottom: 30px; border-left: 5px solid #2C5F6F; }
        .description p { color: #4B5563; line-height: 1.8; font-size: 1.05em; }

        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; font-weight: 600; margin-bottom: 8px; color: #4B5563; font-size: 1em; }
        .input-group input, .input-group select { width: 100%; padding: 14px; border: 2px solid #E5E7EB; border-radius: 8px; font-size: 1em; transition: all 0.3s ease; }
        .input-group input:focus, .input-group select:focus { outline: none; border-color: #2C5F6F; box-shadow: 0 0 0 3px rgba(44, 95, 111, 0.1); }
        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .calculate-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, #E89B6F 0%, #F4A460 100%); color: white; border: none; border-radius: 10px; font-size: 1.2em; font-weight: 700; cursor: pointer; transition: all 0.3s ease; margin-top: 25px; box-shadow: 0 4px 15px rgba(232, 155, 111, 0.4); }
        .calculate-btn:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(232, 155, 111, 0.5); }

        .result-section { margin-top: 40px; display: none; }
        .key-insight { background: linear-gradient(135deg, #E89B6F 0%, #F4A460 100%); color: white; padding: 30px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 4px 20px rgba(44, 95, 111, 0.3); }
        .key-insight h3 { font-size: 1.5em; margin-bottom: 15px; }
        .key-insight p, .key-insight ul { font-size: 1.1em; line-height: 1.8; opacity: 0.95; }
        .key-insight ul { margin-top: 15px; padding-left: 25px; }
        .key-insight li { margin-bottom: 10px; }

        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .metric-card { background: #F8F9FA; padding: 25px; border-radius: 12px; border-left: 5px solid #2C5F6F; transition: all 0.3s ease; }
        .metric-card:hover { transform: translateY(-3px); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .metric-label { font-size: 0.95em; color: #6B7280; margin-bottom: 10px; font-weight: 600; }
        .metric-value { font-size: 2em; font-weight: 700; color: #2C5F6F; word-break: break-word; }

        .status-badge { display: inline-block; padding: 8px 16px; border-radius: 20px; font-weight: 600; font-size: 0.9em; margin-top: 10px; }
        .status-on-track { background: #D1FAE5; color: #065F46; }
        .status-needs-adjustment { background: #FEF3C7; color: #92400E; }
        .status-underfunded { background: #FEE2E2; color: #991B1B; }

        .chart-container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); margin-bottom: 30px; position: relative; height: 450px; }
        .table-wrapper { width: 100%; overflow-x: auto; margin-top: 30px; -webkit-overflow-scrolling: touch; }
        .table-wrapper::-webkit-scrollbar { height: 8px; }
        .table-wrapper::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .table-wrapper::-webkit-scrollbar-thumb { background: #2C5F6F; border-radius: 10px; }
        .table-wrapper::-webkit-scrollbar-thumb:hover { background: #2C5F6F; }
        .data-table { width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 12px rgba(0,0,0,0.08); }
        .data-table thead { background: #2C5F6F; color: white; }
        .data-table th, .data-table td { padding: 16px; text-align: left; border-bottom: 1px solid #E5E7EB; white-space: nowrap; }
        .data-table th { font-weight: 700; }
        .data-table tbody tr { transition: background 0.2s ease; }
        .data-table tbody tr:hover { background: #F8F9FA; }
        .data-table tbody tr:last-child td { border-bottom: none; }
        .retirement-phase { background: #FEF3C7; font-weight: 600; }

        @media (max-width: 768px) {
            .navbar { padding: 10px 15px; }
            .logo { height: 32px; }
            .nav-right { gap: 10px; }
            .search-box { min-width: 50px; padding: 6px 8px; }
            .search-box svg { width: 16px; height: 16px; margin-right: 4px; }
            .search-box input { font-size: 0.8em; }
            .calculator-section { padding: 25px; }
            .chart-container { height: 300px; padding: 20px; }
            .input-row { grid-template-columns: 1fr; }
            .mobile-menu-content { width: 280px; right: -280px; }
            .hamburger { margin-left: 5px; padding: 3px; }
            .hamburger span { width: 24px; }
        }
        @media (max-width: 400px) {
            .navbar { padding: 8px 12px; }
            .logo { height: 28px; }
            .nav-right { gap: 8px; }
            .search-box { min-width: 40px; padding: 5px 6px; }
            .hamburger span { width: 22px; }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <a href="index.html">
                <img src="50F4465B-4D0A-459B-AAD8-B367AAEEF636.jpg" alt="ZenCalcs Logo" class="logo">
            </a>

            <div class="nav-right">
                <div class="search-box" onclick="openSearchInMenu()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <input type="text" placeholder="Search Calculator" readonly onclick="openSearchInMenu()">
                </div>
                <div class="hamburger" onclick="toggleMobileMenu()">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Slide-out Menu -->
    <div class="mobile-menu" id="mobileMenu" onclick="closeMobileMenu()">
        <div class="mobile-menu-content" onclick="event.stopPropagation()">
            <!-- Search Bar -->
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="Search calculators..." onkeyup="filterCalculators()">
            </div>

            <!-- Financial Calculators -->
            <div class="category-header">Financial</div>
            <a href="mortgage-calculator.html" class="mobile-menu-item">Mortgage Calculator</a>
            <a href="loan-calculator.html" class="mobile-menu-item">Loan Calculator</a>
            <a href="auto-loan-calculator.html" class="mobile-menu-item">Auto Loan Calculator</a>
            <a href="compound-interest.html" class="mobile-menu-item">Savings Calculator</a>
            <a href="payment-calculator.html" class="mobile-menu-item">Payment Calculator</a>
            <a href="retirement-calculator.html" class="mobile-menu-item">Retirement Calculator</a>
            <a href="amortization-calculator.html" class="mobile-menu-item">Amortization Calculator</a>
            <a href="investment-calculator.html" class="mobile-menu-item">Investment Calculator</a>
            <a href="inflation-calculator.html" class="mobile-menu-item">Inflation Calculator</a>
            <a href="roi-calculator.html" class="mobile-menu-item">ROI Calculator</a>
            <a href="savings-calculator.html" class="mobile-menu-item">Income Tax Calculator</a>

            <div class="category-divider"></div>

            <!-- Fitness & Health -->
            <div class="category-header">Fitness & Health</div>
            <a href="bmi-calculator.html" class="mobile-menu-item">BMI Calculator</a>
            <a href="calorie-calculator.html" class="mobile-menu-item">Calorie Calculator</a>
            <a href="body-fat-calculator.html" class="mobile-menu-item">Body Fat Calculator</a>
            <a href="bmr-calculator.html" class="mobile-menu-item">BMR Calculator</a>
            <a href="ideal-weight-calculator.html" class="mobile-menu-item">Ideal Weight Calculator</a>
            <a href="pace-calculator.html" class="mobile-menu-item">Pace Calculator</a>
            <a href="pregnancy-calculator.html" class="mobile-menu-item">Pregnancy Calculator</a>
            <a href="due-date-calculator.html" class="mobile-menu-item">Due Date Calculator</a>
            <a href="macro-calculator.html" class="mobile-menu-item">Macro Calculator</a>
            <a href="body-type-calculator.html" class="mobile-menu-item">Body Type Calculator</a>

            <div class="category-divider"></div>

            <!-- Math Calculators -->
            <div class="category-header">Math</div>
            <a href="scientific-calculator.html" class="mobile-menu-item">Scientific Calculator</a>
            <a href="fraction-calculator.html" class="mobile-menu-item">Fraction Calculator</a>
            <a href="percentage-calculator.html" class="mobile-menu-item">Percentage Calculator</a>
            <a href="random-number-generator.html" class="mobile-menu-item">Random Number Generator</a>
            <a href="triangle-calculator.html" class="mobile-menu-item">Triangle Calculator</a>
            <a href="standard-deviation-calculator.html" class="mobile-menu-item">Standard Deviation Calculator</a>
            <a href="square-root-calculator.html" class="mobile-menu-item">Square Root Calculator</a>
            <a href="exponent-calculator.html" class="mobile-menu-item">Exponent Calculator</a>
            <a href="log-calculator.html" class="mobile-menu-item">Log Calculator</a>
            <a href="algebra-calculator.html" class="mobile-menu-item">Algebra Calculator</a>

            <div class="category-divider"></div>

            <!-- Other Calculators -->
            <div class="category-header">Other</div>
            <a href="#" class="mobile-menu-item placeholder">Age Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">Date Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">Time Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">Hours Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">GPA Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">Grade Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">Concrete Calculator</a>
            <a href="#" class="mobile-menu-item placeholder">Password Generator</a>
            <a href="#" class="mobile-menu-item placeholder">Conversion Calculator</a>
            <a href="salary-calculator.html" class="mobile-menu-item">Salary Calculator</a>
        </div>
    </div>

    <div class="container">
        <div class="calculator-section">
            <h1>Retirement Calculator</h1>
            <p class="calc-subtitle">Plan your retirement savings and see if you're on track</p>

            <div class="description">
                <p>Plan for a comfortable retirement with our comprehensive calculator. See if you're on track, calculate how much you need to save, and get personalized recommendations. Our tool factors in inflation, investment returns, and expected income needs to give you a clear picture of your retirement readiness.</p>
            </div>

            <div class="input-row">
                <div class="input-group">
                    <label>Current Age</label>
                    <input type="number" id="currentAge" value="30" min="18" max="100">
                </div>
                <div class="input-group">
                    <label>Planned Retirement Age</label>
                    <input type="number" id="retirementAge" value="65" min="50" max="80">
                </div>
            </div>

            <div class="input-group">
                <label>Life Expectancy</label>
                <input type="number" id="lifeExpectancy" value="85" min="60" max="110">
            </div>

            <div class="input-group">
                <label>Current Annual Income ($)</label>
                <input type="number" id="currentIncome" value="60000" min="0" step="1000">
            </div>

            <div class="input-group">
                <label>Current Retirement Savings ($)</label>
                <input type="number" id="currentSavings" value="50000" min="0" step="1000">
            </div>

            <div class="input-group">
                <label>Monthly Contribution to Retirement ($)</label>
                <input type="number" id="monthlyContribution" value="500" min="0" step="50">
            </div>

            <div class="input-row">
                <div class="input-group">
                    <label>Expected Annual Return (%)</label>
                    <input type="number" id="annualReturn" value="7" step="0.1" min="0" max="20">
                </div>
                <div class="input-group">
                    <label>Expected Annual Inflation (%)</label>
                    <input type="number" id="inflationRate" value="3" step="0.1" min="0" max="10">
                </div>
            </div>

            <div class="input-group">
                <label>Income Needed in Retirement (% of current income)</label>
                <input type="number" id="incomeNeeded" value="80" min="0" max="150" step="5">
            </div>

            <div class="input-group">
                <label>Other Monthly Income in Retirement ($ - e.g., Social Security)</label>
                <input type="number" id="otherIncome" value="2000" min="0" step="100">
            </div>

            <button class="calculate-btn" onclick="calculateRetirement()">Calculate My Retirement Plan</button>
            <div class="result-section" id="result"></div>
        </div>
    </div>

    <script>
        let chartInstance1 = null;
        let chartInstance2 = null;

        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        }

        function formatNumber(value) {
            return new Intl.NumberFormat('en-US', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(value);
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const hamburger = document.querySelector('.hamburger');
            menu.classList.toggle('active');
            hamburger.classList.toggle('active');
        }

        function closeMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const hamburger = document.querySelector('.hamburger');
            menu.classList.remove('active');
            hamburger.classList.remove('active');
        }

        function openSearchInMenu() {
            const menu = document.getElementById('mobileMenu');
            const hamburger = document.querySelector('.hamburger');
            menu.classList.add('active');
            hamburger.classList.add('active');
            setTimeout(() => {
                document.getElementById('searchInput').focus();
            }, 300);
        }

        function filterCalculators() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const items = document.querySelectorAll('.mobile-menu-item');
            const headers = document.querySelectorAll('.category-header');
            const dividers = document.querySelectorAll('.category-divider');

            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });

            // Hide/show category headers based on visible items
            if (searchTerm) {
                headers.forEach(header => header.style.display = 'none');
                dividers.forEach(divider => divider.style.display = 'none');
            } else {
                headers.forEach(header => header.style.display = 'block');
                dividers.forEach(divider => divider.style.display = 'block');
            }
        }

        function calculateRetirement() {
            // Get inputs
            const currentAge = parseInt(document.getElementById('currentAge').value);
            const retirementAge = parseInt(document.getElementById('retirementAge').value);
            const lifeExpectancy = parseInt(document.getElementById('lifeExpectancy').value);
            const currentIncome = parseFloat(document.getElementById('currentIncome').value);
            const currentSavings = parseFloat(document.getElementById('currentSavings').value);
            const monthlyContribution = parseFloat(document.getElementById('monthlyContribution').value);
            const annualReturn = parseFloat(document.getElementById('annualReturn').value) / 100;
            const inflationRate = parseFloat(document.getElementById('inflationRate').value) / 100;
            const incomeNeededPercent = parseFloat(document.getElementById('incomeNeeded').value) / 100;
            const otherMonthlyIncome = parseFloat(document.getElementById('otherIncome').value);

            // Validate inputs
            if (retirementAge <= currentAge) {
                alert('Retirement age must be greater than current age');
                return;
            }
            if (lifeExpectancy <= retirementAge) {
                alert('Life expectancy must be greater than retirement age');
                return;
            }

            // Calculate years
            const yearsUntilRetirement = retirementAge - currentAge;
            const yearsInRetirement = lifeExpectancy - retirementAge;

            // Calculate future value of current savings
            const fvCurrentSavings = currentSavings * Math.pow(1 + annualReturn, yearsUntilRetirement);

            // Calculate future value of monthly contributions
            const monthlyRate = annualReturn / 12;
            const totalMonths = yearsUntilRetirement * 12;
            let fvContributions = 0;
            if (monthlyRate > 0) {
                fvContributions = monthlyContribution * ((Math.pow(1 + monthlyRate, totalMonths) - 1) / monthlyRate);
            } else {
                fvContributions = monthlyContribution * totalMonths;
            }

            // Total at retirement
            const totalAtRetirement = fvCurrentSavings + fvContributions;

            // Calculate income needed in retirement (adjusted for inflation)
            const futureAnnualIncome = currentIncome * Math.pow(1 + inflationRate, yearsUntilRetirement);
            const annualIncomeNeeded = futureAnnualIncome * incomeNeededPercent;
            const monthlyIncomeNeeded = annualIncomeNeeded / 12;

            // Monthly shortfall/surplus
            const monthlyShortfall = monthlyIncomeNeeded - otherMonthlyIncome;

            // Calculate total needed for retirement using withdrawal calculation
            // We'll simulate year-by-year withdrawals with returns during retirement
            let yearByYearData = [];
            let balance = currentSavings;

            // Accumulation phase
            for (let age = currentAge; age < retirementAge; age++) {
                const yearContributions = monthlyContribution * 12;
                const startBalance = balance;
                balance = balance * (1 + annualReturn) + yearContributions;

                yearByYearData.push({
                    age: age,
                    contribution: yearContributions,
                    balance: balance,
                    withdrawal: 0,
                    phase: 'accumulation'
                });
            }

            // Retirement phase - calculate withdrawals with inflation adjustment
            let retirementBalance = balance;
            let totalWithdrawals = 0;
            let yearsOfFunding = 0;

            for (let age = retirementAge; age < lifeExpectancy; age++) {
                const yearsIntoRetirement = age - retirementAge;
                const inflationAdjustedShortfall = monthlyShortfall * Math.pow(1 + inflationRate, yearsIntoRetirement);
                const annualWithdrawal = inflationAdjustedShortfall * 12;

                const startBalance = retirementBalance;

                // Apply return, then subtract withdrawal
                retirementBalance = retirementBalance * (1 + annualReturn) - annualWithdrawal;

                totalWithdrawals += annualWithdrawal;

                if (retirementBalance > 0) {
                    yearsOfFunding++;
                }

                yearByYearData.push({
                    age: age,
                    contribution: 0,
                    balance: Math.max(0, retirementBalance),
                    withdrawal: annualWithdrawal,
                    phase: 'retirement'
                });

                if (retirementBalance < 0) {
                    retirementBalance = 0;
                }
            }

            // Calculate total needed (simple calculation for comparison)
            const totalNeededSimple = monthlyShortfall * 12 * yearsInRetirement;

            // Calculate recommended monthly savings if underfunded
            let recommendedMonthlySavings = monthlyContribution;
            if (yearsOfFunding < yearsInRetirement) {
                // Calculate how much more is needed
                const deficit = totalNeededSimple - totalAtRetirement;
                if (deficit > 0 && monthlyRate > 0) {
                    recommendedMonthlySavings = (deficit / ((Math.pow(1 + monthlyRate, totalMonths) - 1) / monthlyRate));
                } else if (deficit > 0) {
                    recommendedMonthlySavings = deficit / totalMonths;
                }
            }

            // Determine retirement readiness status
            let status = '';
            let statusClass = '';
            let statusMessage = '';

            if (yearsOfFunding >= yearsInRetirement) {
                status = 'On Track';
                statusClass = 'status-on-track';
                statusMessage = "Congratulations! You're on track to have enough savings for your entire retirement.";
            } else if (yearsOfFunding >= yearsInRetirement * 0.75) {
                status = 'Needs Adjustment';
                statusClass = 'status-needs-adjustment';
                statusMessage = "You're close to your goal, but may need to adjust your savings or retirement plans.";
            } else {
                status = 'Underfunded';
                statusClass = 'status-underfunded';
                statusMessage = "Your current savings trajectory may not fully support your retirement. Consider increasing contributions.";
            }

            // 4% rule calculation (safe withdrawal rate)
            const safeWithdrawalAmount = totalAtRetirement * 0.04 / 12;

            // Display results
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `
                <div class="key-insight">
                    <h3>Your Retirement Outlook</h3>
                    <p>Based on your current plan, you'll have <strong>${formatCurrency(totalAtRetirement)}</strong> at retirement (age ${retirementAge}). ${statusMessage}</p>
                    <ul>
                        <li><strong>80% Rule:</strong> Financial experts suggest you'll need about 80% of your pre-retirement income. You're planning for ${(incomeNeededPercent * 100).toFixed(0)}% (${formatCurrency(monthlyIncomeNeeded)}/month).</li>
                        <li><strong>4% Rule:</strong> Using the safe withdrawal rate of 4% annually, you could withdraw ${formatCurrency(safeWithdrawalAmount)}/month indefinitely.</li>
                        <li><strong>Your Funding:</strong> Your retirement savings can support your planned withdrawals for approximately ${yearsOfFunding} years out of ${yearsInRetirement} years in retirement.</li>
                    </ul>
                </div>

                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Retirement Savings at Age ${retirementAge}</div>
                        <div class="metric-value">${formatCurrency(totalAtRetirement)}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Monthly Income Needed in Retirement</div>
                        <div class="metric-value">${formatCurrency(monthlyIncomeNeeded)}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Monthly Shortfall/Surplus</div>
                        <div class="metric-value">${formatCurrency(monthlyShortfall)}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Years of Retirement Funding Available</div>
                        <div class="metric-value">${yearsOfFunding} / ${yearsInRetirement}</div>
                    </div>
                    ${yearsOfFunding < yearsInRetirement ? `
                    <div class="metric-card">
                        <div class="metric-label">Recommended Monthly Savings</div>
                        <div class="metric-value">${formatCurrency(recommendedMonthlySavings)}</div>
                    </div>
                    ` : ''}
                    <div class="metric-card">
                        <div class="metric-label">Retirement Readiness Status</div>
                        <div class="metric-value" style="font-size: 1.5em;">
                            <span class="status-badge ${statusClass}">${status}</span>
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="comparisonChart"></canvas>
                </div>

                <div class="chart-container">
                    <canvas id="timelineChart"></canvas>
                </div>

                <h3 style="margin: 25px 0 15px 0; color: #2D3748; font-size: 1.5em;">Age-by-Age Breakdown</h3>
                <div class="table-wrapper">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Age</th>
                            <th>Annual Contribution</th>
                            <th>Account Balance</th>
                            <th>Annual Withdrawal</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${yearByYearData.map(row => `
                            <tr ${row.phase === 'retirement' ? 'class="retirement-phase"' : ''}>
                                <td><strong>${row.age}</strong></td>
                                <td>${row.contribution > 0 ? formatCurrency(row.contribution) : '-'}</td>
                                <td>${formatCurrency(row.balance)}</td>
                                <td>${row.withdrawal > 0 ? formatCurrency(row.withdrawal) : '-'}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                </div>
            `;

            resultDiv.style.display = 'block';

            // Smooth scroll to results
            setTimeout(() => {
                resultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);

            // Destroy existing charts
            if (chartInstance1) chartInstance1.destroy();
            if (chartInstance2) chartInstance2.destroy();

            // Chart 1: Comparison Bar Chart
            setTimeout(() => {
                const ctx1 = document.getElementById('comparisonChart');
                chartInstance1 = new Chart(ctx1.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Projected Savings', 'Total Withdrawals Needed'],
                        datasets: [{
                            label: 'Amount ($)',
                            data: [totalAtRetirement, totalWithdrawals],
                            backgroundColor: ['#2C5F6F', '#E89B6F'],
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            title: {
                                display: true,
                                text: 'Retirement Savings vs. Total Needed',
                                font: { size: 16, weight: 'bold' }
                            },
                            tooltip: {
                                callbacks: {
                                    label: (context) => formatCurrency(context.parsed.y)
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: (value) => '$' + (value / 1000).toFixed(0) + 'K'
                                },
                                title: {
                                    display: true,
                                    text: 'Amount',
                                    font: { size: 14, weight: 'bold' }
                                }
                            }
                        }
                    }
                });

                // Chart 2: Timeline Line Chart
                const ctx2 = document.getElementById('timelineChart');
                const accumulationData = yearByYearData.filter(d => d.phase === 'accumulation');
                const retirementData = yearByYearData.filter(d => d.phase === 'retirement');

                chartInstance2 = new Chart(ctx2.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: yearByYearData.map(d => d.age),
                        datasets: [
                            {
                                label: 'Account Balance',
                                data: yearByYearData.map(d => d.balance),
                                borderColor: '#2C5F6F',
                                backgroundColor: 'rgba(44, 95, 111, 0.1)',
                                tension: 0.4,
                                fill: true,
                                pointRadius: 0,
                                borderWidth: 3
                            },
                            {
                                label: 'Annual Withdrawal',
                                data: yearByYearData.map(d => d.withdrawal),
                                borderColor: '#E89B6F',
                                backgroundColor: 'rgba(232, 155, 111, 0.1)',
                                tension: 0.4,
                                fill: true,
                                pointRadius: 0,
                                borderWidth: 3
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'top' },
                            title: {
                                display: true,
                                text: 'Savings Growth and Retirement Spending Over Time',
                                font: { size: 16, weight: 'bold' }
                            },
                            tooltip: {
                                callbacks: {
                                    label: (context) => context.dataset.label + ': ' + formatCurrency(context.parsed.y)
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Age',
                                    font: { size: 14, weight: 'bold' }
                                }
                            },
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: (value) => '$' + (value / 1000).toFixed(0) + 'K'
                                },
                                title: {
                                    display: true,
                                    text: 'Amount',
                                    font: { size: 14, weight: 'bold' }
                                }
                            }
                        }
                    }
                });
            }, 100);
        }
    </script>
    <!-- AI Chat Assistant -->
    <link rel="stylesheet" href="css/ai-chat.css">
    <script src="js/ai-chat.js"></script>
</body>
</html>
